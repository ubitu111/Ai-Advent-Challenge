# Быстрый старт Whisper сервера

## Установка и запуск

### 1. Настройка (один раз)
```bash
./setup_whisper.sh
```

### 2. Запуск сервера
```bash
./run_whisper.sh
```

### 3. Остановка сервера
```bash
./stop_whisper.sh
```

## Решение проблем

### Порт 8000 занят

**Автоматическое решение:**
Скрипт `run_whisper.sh` автоматически найдет свободный порт (8001, 8002, и т.д.)

**Ручное решение:**
```bash
# Остановить процесс на порту 8000
./stop_whisper.sh

# Или запустить на другом порту
PORT=8001 ./run_whisper.sh
```

**Обновить URL в приложении:**
Если сервер запущен на другом порту, установите переменную окружения:
```bash
export WHISPER_BASE_URL=http://127.0.0.1:8001
```

Или обновите код в `SpeechRecognitionService.desktop.kt`:
```kotlin
val whisperBaseUrl = "http://127.0.0.1:8001"  // Ваш порт
```

### Проверка работы сервера

```bash
# Health check
curl http://localhost:8000/health

# Должен вернуть: {"status":"ok","model_loaded":true}
```

### Проверка занятых портов

```bash
# Проверить порт 8000
lsof -i :8000

# Проверить все Python процессы
ps aux | grep python | grep whisper
```

## Использование другого порта

### Вариант 1: Переменная окружения
```bash
PORT=8001 ./run_whisper.sh
```

### Вариант 2: Изменить в коде
В `whisper_server.py` измените:
```python
port = int(os.getenv("PORT", "8001"))  # Вместо 8000
```

И обновите URL в приложении (см. выше).

## Модели Whisper

По умолчанию используется модель `base`. Для изменения:

```bash
# Установить переменную окружения
export WHISPER_MODEL=tiny  # или small, medium, large

# Запустить сервер
./run_whisper.sh
```

**Доступные модели:**
- `tiny` - ~39 MB, быстро, низкое качество
- `base` - ~74 MB, средняя скорость, хорошее качество (по умолчанию)
- `small` - ~244 MB, медленнее, лучше качество
- `medium` - ~769 MB, медленная, высокое качество
- `large-v3` - ~1550 MB, очень медленная, максимальное качество

## Логи и отладка

Сервер выводит логи в консоль:
- Загрузка модели
- Транскрибирование файлов
- Ошибки

Для просмотра логов в реальном времени запустите сервер в терминале (не через скрипт).
