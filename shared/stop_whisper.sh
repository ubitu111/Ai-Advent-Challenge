#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ Whisper —Å–µ—Ä–≤–µ—Ä–∞

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Whisper —Å–µ—Ä–≤–µ—Ä–∞..."

# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã Python, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Ä—Ç 8000
PIDS=$(lsof -ti :8000)

if [ -z "$PIDS" ]; then
    echo "‚úÖ –ü–æ—Ä—Ç 8000 —Å–≤–æ–±–æ–¥–µ–Ω, —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    exit 0
fi

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
for PID in $PIDS; do
    echo "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ $PID..."
    kill $PID 2>/dev/null
    if [ $? -eq 0 ]; then
        echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å $PID –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å $PID (–≤–æ–∑–º–æ–∂–Ω–æ, —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)"
    fi
done

# –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ
sleep 1

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—Ä—Ç —Å–≤–æ–±–æ–¥–µ–Ω
if lsof -ti :8000 > /dev/null 2>&1; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8000 –≤—Å–µ –µ—â–µ –∑–∞–Ω—è—Ç, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
    kill -9 $(lsof -ti :8000) 2>/dev/null
    sleep 1
fi

# –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
if lsof -ti :8000 > /dev/null 2>&1; then
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç 8000"
    exit 1
else
    echo "‚úÖ –ü–æ—Ä—Ç 8000 —Å–≤–æ–±–æ–¥–µ–Ω"
fi
